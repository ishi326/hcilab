<!DOCTYPE html>
<html>
<head>
  <title>WebGazer Attention Switch Demo</title>
  <script src="https://webgazer.cs.brown.edu/webgazer.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #timer {
      position: fixed;
      top: 20px;
      right: 20px;
      font-size: 24px;
      background: lightgray;
      padding: 10px 15px;
      border-radius: 8px;
    }

    #centerText {
      font-size: 32px;
      text-align: center;
      width: 50%;
    }

    #results {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-size: 20px;
    }
  </style>
</head>

<body>

<div id="timer">60</div>

<div id="centerText">
  Focus on this text in the middle of the screen.
</div>

<div id="results">
  Switch Count: 0
</div>

<script>
  const timerElement = document.getElementById("timer");
  const centerText = document.getElementById("centerText");
  const results = document.getElementById("results");

  let timeLeft = 60;
  let switchCount = 0;
  let lastRegion = null;
  let trackingActive = true;

  // TIMER COUNTDOWN
  const countdown = setInterval(() => {
    timeLeft--;
    timerElement.innerText = timeLeft;

    if (timeLeft <= 0) {
      clearInterval(countdown);
      trackingActive = false;
      webgazer.end();
      alert("Time's up!\nTotal switches: " + switchCount);
    }
  }, 1000);

  function getRegion(x, y) {
    const timerRect = timerElement.getBoundingClientRect();
    const textRect = centerText.getBoundingClientRect();

    if (
      x >= timerRect.left &&
      x <= timerRect.right &&
      y >= timerRect.top &&
      y <= timerRect.bottom
    ) {
      return "timer";
    }

    if (
      x >= textRect.left &&
      x <= textRect.right &&
      y >= textRect.top &&
      y <= textRect.bottom
    ) {
      return "text";
    }

    return "other";
  }

  webgazer.setGazeListener(function(data, elapsedTime) {
    if (!trackingActive || data == null) return;

    const region = getRegion(data.x, data.y);

    if (region !== "other" && lastRegion !== null && region !== lastRegion) {
      switchCount++;
      results.innerText = "Switch Count: " + switchCount;
    }

    if (region !== "other") {
      lastRegion = region;
    }

  }).begin();

  webgazer.showVideo(false);
  webgazer.showPredictionPoints(false);
</script>

</body>
</html>

